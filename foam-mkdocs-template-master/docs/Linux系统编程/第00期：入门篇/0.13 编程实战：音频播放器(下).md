# 0.13 编程实战：音频播放器(下)
# 设备节点dsp
打开声卡设备文件/dev/dsp
打开音频数据文件xx.wav
从音频文件读一段数据
写入声卡设备文件
关闭文件

## 声卡参数
\#include <linux/soundcard.h>

1. 采样率
取样频率：22050(立体声)、44.1(CD音质)、48(超级CD音质)、192K
采样频率越高音质越好
不同声卡支持的采样率不同，软件设置要根据硬件进行设置
2. 采样格式
量化精度：16bit、20bit、24bit
PCM：线性脉冲编码调制
文件格式：CD(高音质)、WAV(无损)、MP3(压缩)、MIDI、WMA
wav文件：44.1K采样率、16bit量化位数
3. 声道设置
声音在录制或回放时在不同空间位置采集的相互独立的音频信号
声道数(channels)：声音录制时的音源数量或播放时的扬声器数量
分类：单声道、双声道立体声、四声道、5.1杜比环绕、7.1声道

## 代码
```c
#include <unistd.h>
#include <fcntl.h>
#include <sys/types.h>
#include <sys/stat.h>
#include <stdio.h>

#include <sys/ioctl.h>
#include <linux/soundcard.h>

int main (void)
{
	int dst_fd;
	dst_fd = open ("/dev/dsp", O_WRONLY, 0666); /*open dsp*/
	if (dst_fd == -1)
	{
		perror ("open /dev/dsp error!");
		return -1;
	}

	int rate = 44100;
	ioctl (dst_fd, SNDCTL_DSP_SPEED, &rate);	//采样率
	int channels = 2;
	ioctl (dst_fd, SNDCTL_DSP_CHANNELS, &channels);	//声道
	int format = 16;
	ioctl (dst_fd, SNDCTL_DSP_SETFMT, &format);	//采样模式

	int src_fd;
	src_fd  = open ("./fruit.wav", O_RDONLY, 0666);
	if (src_fd == -1)
	{
		perror ("open wav file failed!");
		close (dst_fd);
		return -2;
	}
	int read_count;
	char buf[1024];
	while ((read_count = read(src_fd, buf, 1024)) > 0)
	{
		if (write(dst_fd, buf, read_count) != read_count)
		{
			perror("write /dev/dsp error");
			return -3;
		}
	}
	if (read_count < 0)
	{
		perror("read wav file error");
		return -4;
	}
	close(src_fd);
	close(dst_fd);
	return 0;
}

```