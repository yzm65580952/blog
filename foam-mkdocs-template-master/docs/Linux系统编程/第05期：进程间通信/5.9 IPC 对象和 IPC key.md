# 5.9 IPC 对象和 IPC key
## 什么是IPC对象？
IPC：Inter-process communication
管道通信：FIFO、PIPE，流式数据
消息队列：message queue
信号量：semaphore
共享内存：share memory

## IPC分类
### System V IPC
消息队列：system V message queue
信号量： system V semaphore
共享内存： system V share memory
### POSIX IPC
消息队列：POSIX message queue
信号量： POSIX semaphore
共享内存： POSIX share memory

##  System V 与 POSIX
1. UNIX/Linux的分支众多： AT&T公司的System V、BSD、Mac OS
2. System V release 4：简称SVR4，春秋一霸，1983年起发布的4个版本
3. System V 标准：在SV系统中被广泛使用，然后移植到大多数UNIX中，并加入到了各种标准中
4. POSIX：portable operating system interface， 可移植操作系统接口
5. POSIX.1标准：IEEE于1988年制定的第一个标准
6. POSIX后续标准：兼容了system V的大部分标准，扩展了自己的标准
7. 支持情况：
– 大部分 Linux/Unix 都支持system V 和 POSIX标准接口
– 有些Unix系统对POSIX标准的支持可能不太好

## IPC对象的基本概念
不同进程通过IPC对象通信，IPC对象存储在内核中，全局可见
每个IPC对象在内核中有自己的数据结构，定义在各自头文件中
对IPC对象的引用
– 普通文件：文件名 --- 文件描述符
– IPC 对象 ：IPC key --- IPC 标识符

## 创建IPC key的三种方法
1. 随机选取一个整数值作为key值。
– 所有整数放到一个头文件中，使用IPC对象的程序包含这个头文件即可。
2. 在get系统调用中将IPC_PRIVATE常量作为key值。
– 每个调用都会创建一个全新的IPC对象
– 从而确保每个对象都拥有一个唯一的key
3. 使用ftok函数生成一个(接近唯一)key

## IPC对象的引用基本流程
1. 通过get系统调用创建或打开一个IPC 对象。
– 给定一个整数key，get调用会返回一个整数标识符，即IPC 标识符
2. 通过这个标识符来引用IPC对象、进行各种操作
3. 通过ctl系统调用获取或设置IPC对象的属性、或者删除一个对象
4. IPC对象具有的权限定义在 /Linux/ipc.h文件中

![[Pasted image 20201005231836.png]]

## 各种IPC对象的标识符和句柄
![[Pasted image 20201005231905.png]]