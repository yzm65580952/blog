# 5.7 FIFO应用：LOG日志系统的实现
##  Log日志系统
各个进程往FIFO管道写入数据
守护进程使用FIFO接收各个进程的输出日志信息
并将FIFO中的数据写到对应的日志文件中
## 源码
被监控的进程
```c
/************************************************
*      Filename: process.c
*        Author: litao.wang
*    Bug Report: 3284757626@qq.com
*   Description: 
*        Create: 2019-06-14 06:36:55
* Last Modified: 2019-07-18 15:45:27
*************************************************/
#include <stdio.h>
#include <stdlib.h>
#include <unistd.h>
#include <string.h>
#include <fcntl.h>
#include <sys/stat.h>
#include <sys/types.h>

#define FIFO_SERVER "fifo_log_server"	//fifo管道的名字

int main (void)
{
	mkfifo (FIFO_SERVER, 0644);	//创建管道
	int fifo_fd;
	fifo_fd = open (FIFO_SERVER, O_WRONLY);	//打开fifo管道
	char buf[100];
	while (1)
	{
		memset (buf, 0, 100);
		sprintf (buf, "process %d: log----\n", getpid());
		write (fifo_fd, buf, strlen (buf));	//往fifo写
		sleep (5);
	}
	return 0;
}

```
守护进程收集log
```c
/************************************************
*      Filename: mylog_daemon.c
*        Author: litao.wang
*    Bug Report: 3284757626@qq.com
*   Description: 
*        Create: 2019-06-14 06:36:55
* Last Modified: 2019-07-18 15:45:24
*************************************************/
#include <stdio.h>
#include <stdlib.h>
#include <unistd.h>
#include <string.h>
#include <fcntl.h>
#include <sys/stat.h>
#include <sys/types.h>

#define handle_error(msg) \
    {perror(msg);exit(EXIT_FAILURE);}
#define FIFO_SERVER "fifo_log_server"
#define LOG_PATHNAME    "/var/log/process.log"	//日志文件名

int main (void)
{
	mkfifo (FIFO_SERVER, 0644);	//创建管道
	int ret_from_fork;
	char public_buf[100];
		
	int fifo_fd;
	fifo_fd = open (FIFO_SERVER, O_RDONLY);	//打开管道文件
	memset (public_buf, 0, 100);

	int fd;
	fd = open (LOG_PATHNAME, O_WRONLY | O_CREAT | O_APPEND);
	//打开日志文件
    if (fd == -1)
        handle_error("open");
	int read_len;
	while (1)
	{
		read_len = read (fifo_fd, public_buf, 100);	
		//从fifo读到buf
		if (read_len == -1)
            handle_error("read")
		else if (read_len > 0)
		{
			printf ("%s\n", public_buf);
			write (fd, public_buf, strlen (public_buf));
			//把buf里的内容写到日志文件中
		}
		else
		{
			sleep (3);
			continue;
		}
		sleep (1);
	}
	close (fd);
	return 0;
}
```