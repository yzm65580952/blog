# 5.5 无名管道(4)：通过管道同步进程
## 通过管道同步进程
1. 管道自带同步互斥机制：
– 管道的内核实现：fs/pipe.c
– 通过内核的锁、等待队列等机制实现
2. Write操作可能会阻塞进程
– 当内存缓冲区已满或被读进程锁定
– 直到所有数据被写入到管道为止
3. Read操作进程可能会阻塞进程
– 读进程可以休眠在等待队列，
– 直到所有子进程都关闭了管道的写入端描述符为止
– 父进程的写入端描述符也要关闭，否则父进程读管道时也会被阻塞
– 只有当所有的写端描述符都已关闭，且管道中的数据都被读出，对读端描述符调用read函数才会返回0（即读到EOF标志）
– 当所有的读取端和写入端都关闭后，管道才能被销毁


## 管道缓冲区设置
### 管道对应的内存缓冲区大小
PIPE_BUF的容量是有限的：默认是65536字节
在不同OS下的PIPE_BUF大小设置不同：在 limits.h 头文件中定义
写入管道的数据超过PIPE_BUF大小，内核会分割几块传输
最大值 /proc/sys/fs/pipe-maxsize
查看打开的管道文件：$ cat /proc/PID/fd
### 设置缓冲区大小
特权用户：可以修改上限值
设置缓冲区大小：fcntl (fd, F_SETPIPE_SZ, size)

## PIPE通信特点小结
无名管道(匿名管道)是一个字节流
可通过文件I/O接口读写、但无法lseek
单向通信：一端用于写入、一端用于读出
通信简单、性能单一、只能在近亲进程间通信

