# 4.15 进程组与会话
## 什么是进程组
1. 程组：一组协同工作或关联进程的组合，每个进程组有ID(PGID)
2. 进程属于一个进程组，每个进程组有一个进程组长，该进程组长
ID(PID)与进程组ID(PGID)相同
3. 一个信号可以发送给进程组的所有进程、让所有进程终止、暂停或继续运行

## 什么是会话
 会话是一个或多个进程组的集合
当用户登录系统时，登录进程会为这个用户创建一个新的会话(session)
shell进程(如bash)作为会话的第一个进程，称为会话首进程(session leader)
会话的ID(SID)：等于会话首进程的PID
会话会分配给用户一个控制终端(只能有1个)，用于处理用户的输入输出
一个会话包括了该登录用户的所有活动
会话中的进程组由一个前台进程组和N个后台进程组构成
## 进程与终端的关系
 控制终端：跟会话关联的终端，每个会话会分配0或1个控制终端
– 控制进程：建立与控制终端连接的会话首进程称为控制进程
– 终端的输入和控制信号会发送给前台进程组中的每一个进程
– 控制终端与后台进程之间通过信号通信

## Shell解释器(bash)
1. 进程组和会话都是为支持shell工作而存在
– 用户登录login、登录进程login为用户创建一个login session
– 我们登录的这个终端设备为该会话的控制终端
– Shell进程为该会话首进程、控制进程
– Shell进程ID为会话的ID
2. 为了完成一项任务、shell会启动多个进程(脚本、管道命令)，这些进
程会构成一个进程组
3. 会话的意义在于将很多一起协同工作或相关联的进程、进程组囊括在
一个shell内，方便管理(如信号管理、资源管理等

## 什么是shell
1. 一个读取用户命令、执行命令的程序，也被称为命令解释器
– 用于人机交互、对shell脚本进行解释、执行
– 内置环境变量、循环、条件语句、I/O命令、函数等
– shell可以集成在OS内核中，也可以作为一个独立的应用进程运行
2. 登录shell进程：用户刚登录系统时，由系统创建来运行shell的进程
– Sh：bourne shell, UNIX标配shell,支持管道、重定向、环境变量、后台执行
– Csh：脚本语言语法与C语言类似，支持历史记录、命令行编辑等
– Ksh：兼容sh，并吸取了csh的一些交互式特性
– Bash：GNU项目，目前Linux上使用最广泛的shell

## shell的工作流程
1. Linux内核启动后启动init进程、解析/etc/inittab 登录信息启动getty进程
2. getty进程调用setsid创建新的session和process group、提示用户登录
3. 登录后调用exec加载login程序(/bin/login)(继承getty的PID、PGID、SID)
4. Login进程对用户输入的用户名、密码进行验证
5. Login根据用户输入到/etc/passwd 查找成功后，找出对应UID、GID，并与/etc/shadow文件中对应账号的UID进行匹配验证
6. 验证成功后接着会设置该用户相关的主文件夹、启动shell交互环境
7. 验证成功后会fork子进程并通过exec执行shell(如bash\csh等)
8. 此时login和shell两个进程同属前台进程组、共享虚拟终端
9. Shell进程通过setpgid创建新的进程组、分道扬镳、并将自己设置为前台进程组，跟用户交互
10. 用户输入命令$ c1 | c2 |c3，shell会fork 3个子进程
11. 为这3个进程创建新的进程组，并将该进程组推向前台
12. 3个子进程执行：通过虚拟终端处理输入输出
13. 子进程执行完毕、退出，shell进程又重新回到前台，等待用户新命令

