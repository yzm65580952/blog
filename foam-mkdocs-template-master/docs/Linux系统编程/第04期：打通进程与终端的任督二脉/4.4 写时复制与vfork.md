# 4.4 写时复制与vfork
## 写时复制(copy-on-write)
 对fork-exec流程的改进
1. 对于代码段、数据段等，父子进程可以共享，节省拷贝开销
2. 父子进程的页表项均指向同一块物理内存页帧
3. 当子进程进程空间的内容要修改时，才会真正将段复制到子进程
4. 写时复制：
仅仅为子进程复制父进程的虚拟页表项
对将要修改的页面修改页表项

## vfork
对fork的改进
1. 对fork的改进更为彻底、简单粗暴
2. vfork是为子进程立即执行exec的程序而专门设计的
 无需为子进程复制虚拟内存页或页表，子进程直接共享父进程的资源，
直到其成功执行exec或是调用exit退出
<font color=red>在子进程调用exec之前，将暂停执行父进程</font>

## 代码
```c

/************************************************
*      Filename: vfork_return.c
*        Author: litao.wang
*    Bug Report: 3284757626@qq.com
*   Description: 
*        Create: 2019-03-11 13:22:42
* Last Modified: 2019-03-13 07:52:56
*************************************************/
#include <stdio.h>
#include <stdlib.h>
#include <unistd.h>

int main (void)
{
	int ret_from_fork;
	
	ret_from_fork = vfork ();

	if (ret_from_fork == -1)
	{
		perror ("fork");
		exit (-1);
	}
	else if (ret_from_fork == 0)
	{
		printf ("child process\n");
		//return 0;  //will cause core dump
		exit (0);
	}
	else if (ret_from_fork > 0)
	{
		printf ("father process\n");
		return 0;
	}
	return 0;
}

```
	

