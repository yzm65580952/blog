# 4.11 进程的UID和GID
## 进程的PID
创建进程时系统为每个进程自动分配一个整数，用于进程身份识别
每个进程的PID在内核中是唯一的，不能重复
PID资源有限：$ cat /proc/sys/kernel/pid_max
PPID：该进程父进程的ID号
$ ps ：显示当前终端由当前用户运行的进程
$ ps –a：显示所有终端所有用户正在运行的进程

## 用户和用户组的关系
1. Linux是多用户操作系统，可以允许不同的用户登录
每个用户可以属于不同的组，实现资源的访问权限控制
创建用户没有指定所属组时，系统会创建一个跟用户同名的组
每个用户、组用一个整数ID标识 (uid_t和gid_t类型，其实就是u32)
UID：user ID，创建用户时系统分配的一个整数号码
GID：group ID，系统给用户组分配的一个整数号码
2. /etc/passwd 和/etc/group文件
– Linux系统通过 /etc/passwd 和/etc/group文件将ID与用户名建立关联
– 如 root用户的UID为0，GID为0 | wit 用户的UID为1000，GID为1000
– 该文件还包括的信息
» 组ID：用户所属第一个组的整数型组ID
» 主目录：用户登陆后所居于的初始目录
» 登录shell：执行以解释用户命令的程序名称
## Linux系统中的UID分配
0~255：特权用户
1000以上：普通用户
## 进程与UID之间的关系
1. 每一个进程与用户、用户组相关联
– 进程必须以合适的用户和组运行
– 运行进程的用户ID即该进程的UID
– 该UID和GID表示进程的资源访问、操作权限
2. 进程的各种ID
– RUID：实际用户ID。运行该进程的那个登录用户ID，一般会继承父进程，子进程可通过setuid修改
– EUID：有效用户ID。当前进程所使用的用户ID，一般等于RUID，用于权限验证。
– SUID：设置用户ID。父进程原先的有效ID(执行setuid之前)，子进程会继承并将其设置为有效用户ID

## 一个打印命令
ps -a -o pid,ppid,uid,ruid,euid,suid,cmd,time

## UID相关API
setuid：改变当前进程的UID
getuid：获取当前进程的UID
seteuid：改变当前进程的有效UID
geteuid：获取当前进程的有效UID

```c

/************************************************
*      Filename: setuid.c
*        Author: litao.wang
*    Bug Report: 3284757626@qq.com
*   Description: 
*        Create: 2019-03-14 09:15:12
* Last Modified: 2019-03-14 10:25:44
*************************************************/
#include <stdio.h>
#include <sys/types.h>
#include <unistd.h>
#include <stdlib.h>

int main (void)
{
	int ret_from_fork;

	ret_from_fork = fork ();
	if (ret_from_fork == 0)
	{
		printf ("child process...\n");
		printf ("uid:%d\n", getuid ());
		setuid (1000);
		printf ("uid:%d\n", getuid ());
	//	while (1);
		exit (0);
	}
	
	printf ("father process...\n");
	
	return 0;
}
```
