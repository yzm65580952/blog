# 7.5 等待线程的终止
## 线程的分类
### Joinable  不主动回收资源
PTHREAD_CREATE_JOINABLE
可通过 pthread_join 等待线程终止
调用pthread_join 的线程会阻塞
一个Joinable线程结束时，资源不会自动释放给系统(堆栈、exit状态等)
当线程终止时， <font color=red>pthread_join 会回收该线程的资源，然后返回
若无pthread_join参与“擦屁股”工作，该线程将变为僵尸线程</font>
###  Unjoinable 主动回收资源
PTHREAD_CREATE_DETACHED
可通过 pthread_detach 分离一个线程
当线程终止时，资源会自动释放给系统

## pthread_join
函数原型：int pthread_join (pthread_t thread, void **retval);
函数功能：阻塞掉当前线程，等待指定线程终止
函数终止： void pthread_exit (void *retval);
参数：
– thread：线程的ID
– retval：从pthread_exit 返回的值

## pthread_join demo
```c
#include <stdio.h>
#include <pthread.h>
#include <unistd.h>

int sum = 0;

void * thread_start (void *arg)
{
    int i;
    int len = *(int*)arg;
    for (i = 0; i < len; i++)
    {
        sum += i;
        printf ("sub thread: sum = %d\n", sum);
        sleep (1);
    }
    printf ("sub thread: exit\n");
    pthread_exit (NULL);
}

int main (void)
{
    pthread_t tid;
    int arg = 10;
    pthread_create (&tid, NULL, thread_start, (void *) &arg);
    pthread_join (tid, NULL);	//回收线程
    printf ("sum = %d\n", sum);
    printf ("main thread: exit\n");
    return 0;
}

```

## pthread_detach
一些网站服务的线程不需要阻塞
函数原型： int pthread_detach(pthread_t thread);
函数功能：将指定线程与当前线程分离
参数说明：指定要分离的线程的ID
```c
#include <stdio.h>
#include <pthread.h>
#include <unistd.h>

/*
 * when a detached thread terminate,the resources of the thread wile be 
 * released automatically
 * but the resources of all threads are freed when the process terminates
 */

int sum = 0;

void * thread_start (void *arg)
{
    pthread_detach (pthread_self ());//在子线程内自动分离
    int len = *(int*)arg;
    for (int i = 0; i < len; i++)
    {
        sum += i;
        printf ("sub thread: sum = %d\n", sum);
        sleep (1);
    }
    printf ("sub thread: exit\n");
    pthread_exit (NULL);
}

int main (void)
{
    pthread_t tid;
    int arg = 10;
    pthread_create (&tid, NULL, thread_start, (void *) &arg);
    //pthread_detach (tid);		//分离子线程
    printf ("sum = %d\n", sum);
    printf ("main thread: exit\n");
    pthread_exit (NULL);
    return 0;
}

```